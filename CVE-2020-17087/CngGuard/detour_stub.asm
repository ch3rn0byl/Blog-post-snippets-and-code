.code

__detoured_function proc
		add rsp, 8						; adjust rsp to load the correct values
		mov rax, rsp					; restore the first overwritten instruction
		sub rsp, 8						; readjust for the ret
		mov qword ptr [rax + 8h], rbx	; resteore the second overwritten instruction
		mov qword ptr [rax + 10h], rbp	; restore the third overwritten instruction
		mov qword ptr [rax + 18h], rsi	; restore the fourth overwritten instruction
		cmp dx, 2aabh
		jge status_unsuccessful
		ret

status_unsuccessful:
		xor rcx, rcx					; force it to fail
		ret
__detoured_function endp

end